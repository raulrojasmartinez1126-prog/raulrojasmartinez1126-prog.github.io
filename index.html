<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Buscador CIE-11</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  padding: 40px;
}

h1 {
  color: #0b5ed7;
}

.buscador-container {
  position: relative;
  width: 400px;
}

input {
  width: 100%;
  padding: 10px;
  font-size: 16px;
}

.resultados {
  position: absolute;
  width: 100%;
  background: white;
  border: 1px solid #ccc;
  max-height: 250px;
  overflow-y: auto;
  display: none;
  z-index: 1000;
}

.resultado-item {
  padding: 10px;
  cursor: pointer;
}

.resultado-item:hover {
  background: #e9ecef;
}

.seleccionado {
  margin-top: 20px;
  padding: 15px;
  background: white;
  border: 1px solid #ccc;
}
</style>
</head>

<body>

<h1>Buscador CIE-11</h1>

<div class="buscador-container">
  <input type="text" id="busqueda" placeholder="Escribe un diagnóstico...">
  <div id="resultados" class="resultados"></div>
</div>

<div id="seleccionado" class="seleccionado">
  Aquí aparecerá el diagnóstico seleccionado
</div>

<script>
const input = document.getElementById("busqueda");
const resultadosDiv = document.getElementById("resultados");
const seleccionadoDiv = document.getElementById("seleccionado");

input.addEventListener("input", async () => {
  const texto = input.value;

  if (texto.length < 2) {
    resultadosDiv.style.display = "none";
    return;
  }

  const response = await fetch("http://localhost:3000/search?q=" + texto);
  const data = await response.json();

  resultadosDiv.innerHTML = "";

  data.forEach(item => {
    const div = document.createElement("div");
    div.className = "resultado-item";
    div.innerText = item.titulo + " | Código: " + item.codigo;

    div.addEventListener("click", () => {
      seleccionadoDiv.innerHTML =
        "<strong>" + item.titulo + "</strong><br>Código: " + item.codigo;

      resultadosDiv.style.display = "none";
      input.value = item.titulo;
    });

    resultadosDiv.appendChild(div);
  });

  resultadosDiv.style.display = "block";
});
</script>

</body>
</html>
