<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Evaluaci√≥n Cl√≠nica</title>

<style>
body { margin:0; font-family: Arial,sans-serif; background:#f2f5f9; }
header { background:#0d6efd; color:white; padding:15px; text-align:center; font-size:18px; }
.container { padding:15px; }
.card { background:white; border-radius:12px; padding:15px; margin-bottom:15px; box-shadow:0 4px 10px rgba(0,0,0,0.08);}
h3 { margin-top:0; color:#0d6efd; }

input[type="text"], input[type="number"], select {
  width:100%;
  padding:8px;
  border-radius:8px;
  border:1px solid #ccc;
  margin-top:5px;
}

button {
  width:100%;
  padding:12px;
  background:#0d6efd;
  color:white;
  border:none;
  border-radius:10px;
  font-size:16px;
  margin-top:15px;
}

.sintomas-grid {
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(180px,1fr));
  gap:10px;
  margin-top:15px;
}

.sintoma-card {
  border:1.5px solid #d0d7de;
  border-radius:10px;
  padding:10px;
  background:#fff;
  cursor:pointer;
  display:flex;
  align-items:center;
  gap:8px;
  transition:0.2s;
}

.sintoma-card:hover {
  background:#f0f6ff;
  border-color:#0d6efd;
}

/* üîë CLAVE: checkbox oculto */
.sintoma-card input {
  display:none;
}

/* üîë cuando est√° seleccionado */
.sintoma-card.seleccionado {
  background:#e7f1ff;
  border-color:#0d6efd;
  font-weight:600;
}

.sintoma-card.seleccionado input {
  display:inline-block;
  transform:scale(1.2);
}

.lista-resultados {
  width:100%;
  background:white;
  border:1px solid #ccc;
  border-radius:8px;
  margin-top:5px;
  max-height:250px;
  overflow-y:auto;
  box-shadow:0 4px 10px rgba(0,0,0,0.1);
  z-index:1000;
}

.item-resultado {
  padding:8px;
  cursor:pointer;
  border-bottom:1px solid #eee;
}

.item-resultado:hover {
  background:#f0f6ff;
}
</style>
</head>

<body>

<header>Evaluaci√≥n Cl√≠nica Respiratoria</header>

<div class="container">

  <div class="card">
    <h3>Datos del paciente</h3>
    <label>Nombre</label>
    <input type="text">
    <label>Edad</label>
    <input type="number">
    <label>Sexo</label>
    <select>
      <option value="">Seleccione</option>
      <option>Masculino</option>
      <option>Femenino</option>
    </select>
    <label>Lugar de procedencia</label>
    <input type="text">
    <label>Ocupaci√≥n</label>
    <input type="text">
  </div>

  <div class="card">
    <h3>Buscar s√≠ntoma (CIE-11)</h3>
    <input type="text" id="buscadorSintomas" placeholder="Escribe una letra...">
    <div id="listaResultados" class="lista-resultados"></div>
    <div id="resultadosCIE" class="sintomas-grid"></div>
  </div>

  <button>Generar resumen</button>

</div>

<script>
function normalizar(texto) {
  return texto.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
}

const input = document.getElementById("buscadorSintomas");
const lista = document.getElementById("listaResultados");
const contenedor = document.getElementById("resultadosCIE");

input.addEventListener("input", async function() {
  const texto = this.value.trim();
  lista.innerHTML = "";
  if (!texto) return;

  try {
    const respuesta = await fetch(`http://localhost:3000/buscar?q=${encodeURIComponent(texto)}`);
    const datos = await respuesta.json();

    const textoNorm = normalizar(texto);

    datos
      .filter(i => normalizar(i.titulo).includes(textoNorm))
      .forEach(item => {
        const div = document.createElement("div");
        div.className = "item-resultado";
        div.textContent = `${item.titulo} (${item.codigo})`;

        div.onclick = () => {
          agregarSintoma(item);
          lista.innerHTML = "";
          input.value = "";
        };

        lista.appendChild(div);
      });

  } catch (e) {
    console.error("Error backend:", e);
  }
});

function agregarSintoma(item) {
  const label = document.createElement("label");
  label.className = "sintoma-card seleccionado";

  const checkbox = document.createElement("input");
  checkbox.type = "checkbox";
  checkbox.checked = true;

  label.appendChild(checkbox);
  label.append(` ${item.titulo} (${item.codigo})`);

  label.onclick = () => {
    checkbox.checked = !checkbox.checked;
    label.classList.toggle("seleccionado", checkbox.checked);
  };

  contenedor.appendChild(label);
}
</script>

</body>
</html>
