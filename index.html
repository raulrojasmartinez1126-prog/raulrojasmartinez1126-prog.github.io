<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Evaluación Clínica</title>

<style>
body { margin:0; font-family: Arial,sans-serif; background:#f2f5f9; }
header { background:#0d6efd; color:white; padding:15px; text-align:center; font-size:18px; }
.container { padding:15px; }
.card { background:white; border-radius:12px; padding:15px; margin-bottom:15px; box-shadow:0 4px 10px rgba(0,0,0,0.08);}
h3 { margin-top:0; color:#0d6efd; }

input[type="text"], input[type="number"], select {
  width:100%;
  padding:8px;
  border-radius:8px;
  border:1px solid #ccc;
  margin-top:5px;
}

button {
  width:100%;
  padding:12px;
  background:#0d6efd;
  color:white;
  border:none;
  border-radius:10px;
  font-size:16px;
  margin-top:15px;
}

.sintomas-grid {
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(180px,1fr));
  gap:10px;
  margin-top:15px;
}

.sintoma-card {
  border:1.5px solid #d0d7de;
  border-radius:10px;
  padding:10px;
  background:#fff;
  cursor:pointer;
  display:flex;
  align-items:center;
  gap:8px;
  transition:0.2s;
}

.sintoma-card:hover {
  background:#f0f6ff;
  border-color:#0d6efd;
}

.sintoma-card input { display:none; }

.sintoma-card.seleccionado {
  background:#e7f1ff;
  border-color:#0d6efd;
  font-weight:600;
}

.sintoma-card.seleccionado input {
  display:inline-block;
  transform:scale(1.2);
}

.lista-resultados {
  width:100%;
  background:white;
  border:1px solid #ccc;
  border-radius:8px;
  margin-top:5px;
  max-height:220px;
  overflow-y:auto;
  box-shadow:0 4px 10px rgba(0,0,0,0.1);
}

.item-resultado {
  padding:8px;
  cursor:pointer;
  border-bottom:1px solid #eee;
}

.item-resultado:hover {
  background:#f0f6ff;
}
</style>
</head>

<body>

<header>Evaluación Clínica Respiratoria</header>

<div class="container">

  <div class="card">
    <h3>Datos del paciente</h3>
    <input type="text" id="nombre" placeholder="Nombre">
    <input type="number" id="edad" placeholder="Edad">
    <select id="sexo">
      <option value="">Sexo</option>
      <option>Masculino</option>
      <option>Femenino</option>
      <input type="text" id="ocupacion" placeholder="Ocupacion">
    <input type="text" id="lugardeprocedencia" placeholder="Lugar de procedencia">
    </select>
  </div>

  <div class="card">
    <h3>Buscar síntoma (CIE-11)</h3>
    <input type="text" id="buscadorSintomas" placeholder="Ej: tos, disnea...">
    <div id="listaResultados" class="lista-resultados"></div>
    <div id="resultadosCIE" class="sintomas-grid"></div>
  </div>

  <div class="card">
    <h3>Buscar signos clínicos</h3>
    <input type="text" id="buscadorSignos" placeholder="Ej: sibilancias, crépitos...">
    <div id="listaSignos" class="lista-resultados"></div>
    <div id="resultadosSignos" class="sintomas-grid"></div>
  </div>

  <!-- ✅ RESUMEN -->
  <div class="card">
    <h3>Resumen clínico</h3>
    <textarea id="resumenClinico" rows="10" style="width:100%; padding:10px; border-radius:10px; border:1px solid #ccc;" placeholder="Aquí se generará el resumen clínico..."></textarea>
  </div>

  <button onclick="generarResumen()">Generar resumen</button>
</div>

<script>
function normalizar(t) {
  return t.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
}

/* ===== CIE ===== */
const inputCIE = document.getElementById("buscadorSintomas");
const listaCIE = document.getElementById("listaResultados");
const contCIE = document.getElementById("resultadosCIE");

inputCIE.addEventListener("input", async function() {
  const q = this.value.trim();
  listaCIE.innerHTML = "";
  if (!q) return;

  const res = await fetch(`http://localhost:3000/buscar?q=${encodeURIComponent(q)}`);
  const datos = await res.json();

  datos.forEach(item => {
    const d = document.createElement("div");
    d.className = "item-resultado";
    d.textContent = `${item.titulo} (${item.codigo})`;
    d.onclick = () => {
      agregarItem(contCIE, `${item.titulo} (${item.codigo})`);
      listaCIE.innerHTML = "";
      inputCIE.value = "";
    };
    listaCIE.appendChild(d);
  });
});

/* ===== SIGNOS CLÍNICOS GENERALES ===== */
const signos = [
  "Fiebre",
  "Hipotermia",
  "Escalofríos",
  "Diaforesis",
  "Palidez",
  "Cianosis",
  "Ictericia",
  "Rubor",
  "Taquicardia",
  "Bradicardia",
  "Hipotensión",
  "Hipertensión",
  "Taquipnea",
  "Bradipnea",
  "Apnea",
  "Disnea",
  "Ortopnea",
  "Platipnea",
  "Respiración superficial",
  "Respiración profunda",
  "Respiración irregular",
  "Respiración paradójica",
  "Respiración de Cheyne-Stokes",
  "Respiración de Kussmaul",
  "Respiración de Biot",
  "Aleteo nasal",
  "Uso de músculos accesorios",
  "Tiraje intercostal",
  "Tiraje subcostal",
  "Tiraje supraclavicular",
  "Asimetría torácica",
  "Tórax en tonel",
  "Sibilancias",
  "Crépitantes",
  "Roncus",
  "Estertores",
  "Silencio auscultatorio",
  "Disminución del murmullo vesicular",
  "Aumento del murmullo vesicular",
  "Soplo tubario",
  "Frote pleural",
  "Matidez a la percusión",
  "Hipersonoridad",
  "Submatidez",
  "Dolor torácico",
  "Dolor pleurítico",
  "Hemoptisis",
  "Expectoración purulenta",
  "Expectoración hemática",
  "Tos seca",
  "Tos productiva",
  "Edema periférico",
  "Edema facial",
  "Edema generalizado",
  "Ingurgitación yugular",
  "Cianosis periférica",
  "Llenado capilar prolongado",
  "Pulso débil",
  "Pulso filiforme",
  "Pulso irregular",
  "Arritmia",
  "Soplo cardíaco",
  "Galope",
  "Frote pericárdico",
  "Dolor abdominal",
  "Distensión abdominal",
  "Defensa abdominal",
  "Rigidez abdominal",
  "Masa palpable",
  "Hepatomegalia",
  "Esplenomegalia",
  "Ascitis",
  "Náuseas",
  "Vómitos",
  "Hematemesis",
  "Melena",
  "Hematochezia",
  "Diarrea",
  "Estreñimiento",
  "Anorexia",
  "Disfagia",
  "Odinofagia",
  "Reflujo",
  "Globo vesical",
  "Disuria",
  "Polaquiuria",
  "Nicturia",
  "Hematuria",
  "Incontinencia urinaria",
  "Retención urinaria",
  "Oliguria",
  "Anuria",
  "Secreción uretral",
  "Secreción vaginal",
  "Sangrado vaginal",
  "Amenorrea",
  "Menorragia",
  "Dolor pélvico",
  "Dolor testicular",
  "Disfunción eréctil",
  "Ginecomastia",
  "Alteración del estado de conciencia",
  "Confusión",
  "Desorientación",
  "Somnolencia",
  "Letargo",
  "Agitación",
  "Coma",
  "Convulsiones",
  "Cefalea",
  "Mareo",
  "Vértigo",
  "Síncope",
  "Déficit motor",
  "Déficit sensitivo",
  "Parestesias",
  "Ataxia",
  "Temblor",
  "Rigidez",
  "Hipotonía",
  "Hipertonía",
  "Marcha inestable",
  "Fotofobia",
  "Visión borrosa",
  "Diplopía",
  "Pérdida visual",
  "Dolor ocular",
  "Hiperemia conjuntival",
  "Secreción ocular",
  "Hipoacusia",
  "Otalgia",
  "Otorragia",
  "Secreción ótica",
  "Epistaxis",
  "Rinorrea",
  "Congestión nasal",
  "Ulceraciones orales",
  "Halitosis",
  "Lengua saburral",
  "Adenopatías",
  "Eritema",
  "Lesiones cutáneas",
  "Exantema",
  "Petequias",
  "Equimosis",
  "Hematomas",
  "Úlceras",
  "Prurito",
  "Caída de cabello",
  "Uñas frágiles",
  "Dedos en palillo de tambor",
  "Dolor articular",
  "Tumefacción articular",
  "Limitación de movilidad",
  "Rigidez matutina",
  "Dolor muscular",
  "Debilidad muscular",
  "Fatiga",
  "Astenia",
  "Pérdida de peso",
  "Aumento de peso"
];


const inputSignos = document.getElementById("buscadorSignos");
const listaSignos = document.getElementById("listaSignos");
const contSignos = document.getElementById("resultadosSignos");

inputSignos.addEventListener("input", function() {
  const q = normalizar(this.value);
  listaSignos.innerHTML = "";
  if (!q) return;

  signos.filter(s => normalizar(s).includes(q)).forEach(s => {
    const d = document.createElement("div");
    d.className = "item-resultado";
    d.textContent = s;
    d.onclick = () => {
      agregarItem(contSignos, s);
      listaSignos.innerHTML = "";
      inputSignos.value = "";
    };
    listaSignos.appendChild(d);
  });
});

/* ===== AGREGAR ITEM ===== */
function agregarItem(contenedor, texto) {
  const label = document.createElement("label");
  label.className = "sintoma-card seleccionado";

  const check = document.createElement("input");
  check.type = "checkbox";
  check.checked = true;

  label.appendChild(check);
  label.append(" " + texto);

  label.onclick = () => {
    check.checked = !check.checked;
    label.classList.toggle("seleccionado", check.checked);
  };

  contenedor.appendChild(label);
}

/* ===== RESUMEN ===== */
function generarResumen() {
  const nombre = document.getElementById("nombre").value;
  const edad = document.getElementById("edad").value;
  const sexo = document.getElementById("sexo").value;

  const sintomas = [...document.querySelectorAll("#resultadosCIE .seleccionado")]
    .map(e => e.textContent.trim());

  const signosSel = [...document.querySelectorAll("#resultadosSignos .seleccionado")]
    .map(e => e.textContent.trim());

  let texto = "";
  texto += `Paciente ${nombre || "NN"}, ${edad || "N/E"} años, sexo ${sexo || "N/E"}.\n\n`;

  if (sintomas.length) {
    texto += "Síntomas referidos:\n";
    sintomas.forEach(s => texto += `- ${s}\n`);
    texto += "\n";
  }

  if (signosSel.length) {
    texto += "Signos clínicos:\n";
    signosSel.forEach(s => texto += `- ${s}\n`);
    texto += "\n";
  }

  texto += "Evaluación clínica orientada a patología respiratoria. Correlacionar con examen físico completo y estudios complementarios según criterio médico.";

  document.getElementById("resumenClinico").value = texto;
}
</script>

</body>
</html>
